<!DOCTYPE html>
<html>
<head>
  <title><%= appName %> â€” Sales</title>
  <link rel="stylesheet" href="/css/base.css">
  <link rel="stylesheet" href="/css/components.css">
  <link rel="stylesheet" href="/css/sales.css">

</head>
<style>
@media print {
  body {
    background: #fff !important;
    color: #000 !important;
  }

  .app-header-bar,
  .sales-filters,
  .sales-actions {
    display: none !important;
  }

  table {
    border-collapse: collapse;
  }

  th, td {
    border: 1px solid #000 !important;
  }
}
</style>
<body>
<div class="app">

<header class="app-header-bar">
  <div class="app-brand">
    <span class="app-title"><%= appName %></span>
    <p class="app-tagline">Sales report</p>
  </div>

  <nav class="main-nav">
    <a class="nav-link" href="/inventory">Inventory</a>
    <a class="nav-link" href="/catalog">Catalog</a>
    <a class="nav-link" href="/billing">Billing</a>
    <a class="nav-link" href="/bills">Bills</a>
    <a class="nav-link active" href="/sales">Sales</a>
  </nav>

  <div class="app-header-right">
    <form method="POST" action="/logout">
      <button type="submit" class="user-menu-btn">
        <span class="user-avatar">
          <%= (currentUser?.username || 'U').charAt(0).toUpperCase() %>
        </span>
        <span><%= currentUser?.username || 'User' %></span>
      </button>
    </form>
    <div class="header-actions">
    <button id="theme-toggle">Dark Theme ðŸŒ™</button>
  </div>
  </div>
</header>

<main class="app-main">
<section class="panel sales-page">

<h2>Sales Report</h2>

<form class="sales-filters" method="GET">
  <input type="date" name="date" value="<%= filters.date || '' %>">

  <select name="sort">
    <option value="">Date</option>
    <option value="customer" <%= filters.sort === 'customer' ? 'selected' : '' %>>
      Customer
    </option>
  </select>

<input
  type="text"
  name="q"
  class="sales-search"
  placeholder="Search customer name"
  value="<%= filters.q || '' %>"
/>

  <button type="submit">Apply</button>
</form>

<div class="sales-summary">
  <div><span>Bills</span><strong><%= summary.bills %></strong></div>
  <div><span>Subtotal</span><strong>â‚¹<%= summary.subtotal.toFixed(2) %></strong></div>
  <div><span>GST Paid</span><strong>â‚¹<%= summary.gst.toFixed(2) %></strong></div>
  <div><span>Total</span><strong>â‚¹<%= summary.total.toFixed(2) %></strong></div>
</div>

<table class="sales-table">
<thead>
<tr>
  <th>#</th>
  <th>Invoice</th>
  <th>Date</th>
  <th>Customer</th>
  <th>Qty</th>
  <th>Line Total</th>
  <th>Bill Total</th>
</tr>
</thead>

<tbody>
<% if (rows.length) { %>
  <% rows.forEach((r, i) => { %>
    <tr>
      <td><%= i + 1 %></td>
      <td>
  <a href="/billing/print/<%= r.bill_id %>" target="_blank">
    <%= r.invoice_no %>
  </a>
</td>
      <td><%= new Date(r.created_at).toLocaleDateString("en-GB") %></td>
      <td><%= r.customer_name %></td>
      <td><%= r.qty %></td>
      <td>â‚¹<%= r.line_total.toFixed(2) %></td>
      <td>â‚¹<%= r.bill_total.toFixed(2) %></td>
    </tr>
  <% }) %>
<% } else { %>
  <tr><td colspan="7">No sales found</td></tr>
<% } %>
</tbody>
</table>
<div class="sales-actions">
  <a
    href="/sales/export?<%= new URLSearchParams(filters).toString() %>"
    class="btn btn-secondary"
  >
    â¬‡ Export CSV
  </a>

  <button onclick="window.print()" class="btn btn-primary">
    ðŸ–¨ Print Report
  </button>
</div>
</section>
</main>
</div>

<script src="/js/sales.js"></script>
<script src="/js/theme.js"></script>
</body>
</html>