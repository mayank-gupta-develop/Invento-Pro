<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title><%= appName %> â€” Inventory</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/style.css" />
  </head>
  <body>
    <div class="app">
      <!-- Navbar -->
      <header class="app-header app-header-bar">
  <!-- Brand (left) -->
  <div class="app-brand">
    <div class="app-title-row">
      <span class="app-title"><%= appName %></span>
      <span class="app-badge">Dashboard</span>
    </div>
    <p class="app-tagline">Smart inventory, catalog &amp; billing.</p>
  </div>

  <!-- Mobile nav toggle -->
  <button
    type="button"
    class="nav-toggle"
    id="nav-toggle"
    aria-label="Toggle navigation"
  >
    <span></span>
    <span></span>
    <span></span>
  </button>

  <!-- Main nav -->
  <nav class="main-nav" id="main-nav">
    <a href="/inventory" class="nav-link active">Inventory</a>
    <a href="/catalog" class="nav-link">Catalog</a>
    <a href="/billing" class="nav-link">Billing</a>
    <a href="/bills" class="nav-link">Bills</a>
    <a href="/sales" class="nav-link">Sales</a>
  </nav>

  <!-- Right side: theme + user menu -->
  <div class="app-header-right">
    <!-- Keep same ID so existing theme.js keeps working -->
    <button
  type="button"
  id="theme-toggle"
  class="icon-btn small"
  aria-label="Toggle theme"
>
  ðŸŒ“
</button>

    <div class="user-menu">
      <button
        type="button"
        class="user-menu-btn"
        id="user-menu-btn"
        aria-haspopup="true"
        aria-expanded="false"
      >
        <span class="user-avatar">
          <%= (user.name || user.username || 'U').charAt(0).toUpperCase() %>
        </span>
        <div class="user-menu-meta">
          <span class="user-menu-name">
            <%= user.name || user.username %>
          </span>
          <% if (user.username) { %>
          <span class="user-menu-username">@<%= user.username %></span>
          <% } %>
        </div>
      </button>

      <div class="user-menu-dropdown" id="user-menu-dropdown">
        <div class="user-menu-section">
          <% if (user.email) { %>
          <div class="user-menu-row">
            <span class="user-menu-icon">ðŸ“§</span>
            <span class="user-menu-text"><%= user.email %></span>
          </div>
          <% } %>
          <% if (user.phone) { %>
          <div class="user-menu-row">
            <span class="user-menu-icon">ðŸ“±</span>
            <span class="user-menu-text"><%= user.phone %></span>
          </div>
          <% } %>
        </div>

        <div class="user-menu-section user-menu-section-actions">
          <form method="POST" action="/logout">
            <button type="submit" class="user-menu-link user-menu-logout">
              Log out
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
</header>

      <main class="app-main">
        <!-- INVENTORY FORM -->
        <section class="panel">
          <h2>Inventory</h2>
          <form id="item-form" autocomplete="off">
            <input type="hidden" id="item-id" />

            <div class="form-row">
              <div class="form-group">
                <label for="item-name">Item Name</label>
                <input
                  type="text"
                  id="item-name"
                  placeholder="e.g. Wireless Mouse"
                  required
                />
              </div>

              <div class="form-group">
                <label for="item-sku">SKU / Code</label>
                <input
                  type="text"
                  id="item-sku"
                  placeholder="e.g. WM-1001"
                  required
                />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="item-category">Category</label>
                <input
                  type="text"
                  id="item-category"
                  placeholder="e.g. Electronics"
                />
              </div>

              <div class="form-group">
                <label for="item-qty">Quantity</label>
                <input
                  type="number"
                  id="item-qty"
                  min="0"
                  step="1"
                  placeholder="e.g. 10"
                  required
                />
              </div>

              <div class="form-group">
                <label for="item-price">Base Price (per unit)</label>
                <input
                  type="number"
                  id="item-price"
                  min="0"
                  step="0.01"
                  placeholder="e.g. 499.99"
                  required
                />
              </div>

              <div class="form-group">
                <label for="item-gst">GST %</label>
                <input
                  type="number"
                  id="item-gst"
                  min="0"
                  step="0.01"
                  placeholder="e.g. 18"
                />
              </div>
            </div>

            <div class="form-actions">
              <button type="submit" id="submit-btn">Add Item</button>
              <button type="button" id="reset-btn" class="secondary">
                Clear Form
              </button>
            </div>
          </form>
        </section>

        <!-- SEARCH + FILTER -->
        <section class="panel">
          <h2>Search & Filter</h2>
          <div class="filter-row">
            <div class="form-group">
              <label for="search-input">Search (Name / SKU)</label>
              <input
                type="text"
                id="search-input"
                placeholder="Type to search..."
              />
            </div>

            <div class="form-group">
              <label for="filter-category">Category</label>
              <select id="filter-category">
                <option value="all">All Categories</option>
              </select>
            </div>

            <div class="form-group">
              <label>&nbsp;</label>
              <button type="button" id="export-btn" class="secondary">
                Export CSV
              </button>
            </div>
          </div>
        </section>

        <!-- INVENTORY TABLE -->
        <section class="panel">
          <div class="panel-header">
            <h2>Inventory List</h2>
            <span id="empty-state" class="muted">
              No items yet. Add your first item above.
            </span>
          </div>

          <div class="table-wrapper">
            <table>
              <thead>
                <tr>
                  <th>#</th>
                  <th>Name</th>
                  <th>SKU</th>
                  <th>Category</th>
                  <th>Qty</th>
                  <th>Base Price</th>
                  <th>GST %</th>
                  <th>Price + GST</th>
                  <th>Total (incl GST)</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="inventory-body"></tbody>
            </table>
          </div>

          <div class="stats">
            <div class="stat">
              <span class="stat-label">Total Items</span>
              <span class="stat-value" id="stat-items">0</span>
            </div>
            <div class="stat">
              <span class="stat-label">Total Quantity</span>
              <span class="stat-value" id="stat-qty">0</span>
            </div>
            <div class="stat">
              <span class="stat-label">Total Value (incl GST)</span>
              <span class="stat-value" id="stat-value">0.00</span>
            </div>
          </div>
        </section>
      </main>
    </div>

        <!-- Theme + header behaviour (inline, guaranteed to run) -->
    <script>
      (function () {
        const root = document.documentElement;
        const storedTheme = window.localStorage.getItem("invento-theme");

        // Apply stored theme on load
        if (storedTheme === "dark" || storedTheme === "light") {
          root.setAttribute("data-theme", storedTheme);
        }

        const applyTheme = (next) => {
          root.setAttribute("data-theme", next);
          window.localStorage.setItem("invento-theme", next);
        };

        // Hook header button
        const themeBtn = document.getElementById("theme-toggle");
        if (themeBtn) {
          themeBtn.addEventListener("click", () => {
            const current = root.getAttribute("data-theme") || "light";
            const next = current === "dark" ? "light" : "dark";
            applyTheme(next);
          });
        }

        // Mobile nav + user menu (kept here so it's always active)
        const navToggle = document.getElementById("nav-toggle");
        const mainNav = document.getElementById("main-nav");
        const userMenuBtn = document.getElementById("user-menu-btn");
        const userMenuDropdown = document.getElementById("user-menu-dropdown");

        if (navToggle && mainNav) {
          navToggle.addEventListener("click", (e) => {
            e.stopPropagation();
            mainNav.classList.toggle("open");
            navToggle.classList.toggle("open");
          });

          document.addEventListener("click", () => {
            mainNav.classList.remove("open");
            navToggle.classList.remove("open");
          });

          mainNav.addEventListener("click", (e) => e.stopPropagation());
        }

        if (userMenuBtn && userMenuDropdown) {
          userMenuBtn.addEventListener("click", (e) => {
            e.stopPropagation();
            const isOpen = userMenuDropdown.classList.contains("open");
            document
              .querySelectorAll(".user-menu-dropdown.open")
              .forEach((el) => el.classList.remove("open"));
            if (!isOpen) userMenuDropdown.classList.add("open");
          });

          document.addEventListener("click", () => {
            userMenuDropdown.classList.remove("open");
          });
        }
      })();
    </script>

    <!-- Your main dashboard JS (inventory/catalog/billing logic) -->
    <script src="/index.js"></script>   
    <script src="/theme.js"></script>
  </body>
</html>